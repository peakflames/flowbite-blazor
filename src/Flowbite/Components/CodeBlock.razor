
@inherits FlowbiteComponentBase
@using Microsoft.JSInterop

@if (CopyToClipboard)
{
    var codeToDisplay = $"\n{Code}\n\n";

    <button type="button" class="relative border border-gray-100 dark:border-gray-800 rounded-lg flex items-center group hover:cursor-pointer">
        <div class="bg-[#1F2A37] absolute top-0 left-0 w-full h-full group-hover:opacity-80 opacity-0 rounded-lg transition-opacity flex items-center justify-center">
            <div class="flex items-center">
                <CopyToClipboardButton TextToCopy="@Code" class="text-white" ShowTitle />
            </div>
        </div>
        
        <pre @ref="@_ref" class="@CombineClasses(LanguageClass, Class, "w-full flex")"><code id="@Id" class="@LanguageClass">@codeToDisplay</code></pre>    
    </button>
}
else
{
    <pre @ref="@_ref" class="@CombineClasses(LanguageClass, Class)"><code id="@Id" class="@LanguageClass">@Code</code></pre>
}             

@code
{
    private ElementReference _ref;

    [Parameter]
    public string? Id { get; set; }

    [Parameter, EditorRequired]
    public string? Code { get; set; }

    [Parameter]
    public string? Language { get; set; }

    [Parameter]
    public bool CopyToClipboard { get; set; } = false;

    [Inject]
    private IJSRuntime? JSRuntime { get; set; }

    protected string LanguageClass => $"language-{Language}";

    protected override async Task OnAfterRenderAsync( bool firstRender )
    {
        if( firstRender && JSRuntime is not null)
        {
            await JSRuntime.InvokeVoidAsync( "Prism.highlightAllUnder", _ref );
        }
    }
}
